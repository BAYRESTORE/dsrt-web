<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DSRT - Digital Smart Revise Technology</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin:0; padding:0;
    height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    background: #f5f7fa;
  }
  /* Sidebar */
  #sidebar {
    width: 280px;
    background: #1e90ff;
    color: white;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  #sidebar h2 {
    margin: 0;
    padding: 16px;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    font-size: 18px;
    border-bottom: 1px solid rgba(255,255,255,0.3);
  }
  #sidebar ul {
    list-style: none;
    margin: 0;
    padding: 0 16px 16px 16px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
  #sidebar ul.expanded {
    max-height: 600px;
    overflow-y: auto;
  }
  #sidebar ul li {
    padding: 10px 8px;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s;
  }
  #sidebar ul li:hover, #sidebar ul li.active {
    background: rgba(255,255,255,0.3);
  }
  /* Toggle icon */
  .toggle-icon {
    border-style: solid;
    border-width: 6px 6px 0 6px;
    border-color: white transparent transparent transparent;
    display: inline-block;
    transition: transform 0.3s ease;
  }
  .expanded > .toggle-icon {
    transform: rotate(180deg);
  }
  /* Main content */
  #main {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 20px;
  }
  #canvas-container {
    flex-grow: 1;
    background: #ddd;
    border: 2px dashed #999;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  #canvas {
    max-width: 100%;
    max-height: 100%;
    border-radius: 8px;
  }
  /* Controls */
  #controls {
    margin-top: 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }
  button, select {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    user-select: none;
    background: #1e90ff;
    color: white;
    transition: background-color 0.3s;
  }
  button:hover, select:hover {
    background: #187bcd;
  }
  input[type=range] {
    width: 250px;
  }
  /* Slider panel */
  #slider-panel {
    margin-top: 20px;
    background: white;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 3px 8px rgb(0 0 0 / 0.15);
    max-width: 400px;
  }
  #slider-panel label {
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
  }
  /* Back button */
  #back-btn {
    margin-top: auto;
    padding: 12px 20px;
    background: #f44336;
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s;
  }
  #back-btn:hover {
    background: #d32f2f;
  }

  /* Responsive */
  @media (max-width: 768px) {
    body {
      flex-direction: column;
    }
    #sidebar {
      width: 100%;
      height: auto;
      flex-direction: row;
      overflow-x: auto;
    }
    #sidebar h2 {
      flex: 1;
      padding: 12px 8px;
      font-size: 16px;
      border-bottom: none;
      border-right: 1px solid rgba(255,255,255,0.3);
    }
    #sidebar ul {
      max-height: none !important;
      padding: 0 8px;
      display: flex;
      gap: 8px;
      overflow-x: auto;
    }
    #sidebar ul li {
      border-radius: 4px;
      padding: 8px 12px;
      white-space: nowrap;
    }
    #main {
      padding: 10px;
    }
    #slider-panel {
      max-width: 100%;
      margin-top: 12px;
    }
    input[type=range] {
      width: 100%;
    }
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2 id="filter-header" class="expandable">FILTER
    <span class="toggle-icon"></span>
  </h2>
  <ul id="filter-list" class="">
    <li data-filter="hue">Hue</li>
    <li data-filter="sepia">Sepia</li>
    <li data-filter="blur">Blur</li>
    <li data-filter="bmw">BMW</li>
    <li data-filter="grayscale">Grayscale</li>
    <li data-filter="invert">Invert</li>
    <li data-filter="brightness">Brightness</li>
    <li data-filter="contrast">Contrast</li>
    <li data-filter="saturation">Saturation</li>
    <li data-filter="others">Others</li>
  </ul>

  <h2 id="tools-header" class="expandable">MANUAL TOOLS
    <span class="toggle-icon"></span>
  </h2>
  <ul id="tools-list" class="">
    <li data-tool="basic">Basic</li>
    <li data-tool="intermediate">Intermediate</li>
    <li data-tool="pro">Pro</li>
  </ul>

  <button id="back-btn">&lt; Back</button>
</div>

<div id="main">
  <div id="canvas-container">
    <canvas id="canvas" width="600" height="400" style="background:#fff; border-radius:8px;"></canvas>
  </div>
  <div id="slider-panel" style="display:none;">
    <label for="slider">Intensitas <span id="slider-label"></span></label>
    <input type="range" id="slider" min="0" max="200" value="100" />
  </div>
  <div id="controls">
    <input type="file" id="upload" accept="image/*" />
    <button id="reset-btn">Reset</button>
    <select id="download-res">
      <option value="320">Download 320px</option>
      <option value="640" selected>Download 640px</option>
      <option value="1280">Download 1280px</option>
      <option value="1920">Download 1920px</option>
    </select>
    <button id="download-btn">Download</button>
  </div>
</div>

<script>
  // Sidebar accordion toggles
  const filterHeader = document.getElementById('filter-header');
  const filterList = document.getElementById('filter-list');
  const toolsHeader = document.getElementById('tools-header');
  const toolsList = document.getElementById('tools-list');

  function toggleAccordion(header, list) {
    header.addEventListener('click', () => {
      const expanded = list.classList.toggle('expanded');
      header.classList.toggle('expanded', expanded);
    });
  }
  toggleAccordion(filterHeader, filterList);
  toggleAccordion(toolsHeader, toolsList);

  // Variables for canvas and image
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let originalImage = null;
  let currentFilter = null;
  let currentFilterValue = 100;

  // Upload image
  const uploadInput = document.getElementById('upload');
  uploadInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
      const img = new Image();
      img.onload = function() {
        // Resize canvas to image ratio max 600x400
        let w = img.width;
        let h = img.height;
        const maxW = 600;
        const maxH = 400;
        if(w > maxW || h > maxH) {
          const scale = Math.min(maxW/w, maxH/h);
          w = w*scale;
          h = h*scale;
        }
        canvas.width = w;
        canvas.height = h;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, w, h);
        originalImage = img;
        resetFilter();
      }
      img.src = ev.target.result;
    }
    reader.readAsDataURL(file);
  });

  // Reset button
  const resetBtn = document.getElementById('reset-btn');
  resetBtn.addEventListener('click', () => {
    if (!originalImage) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
    resetFilter();
  });

  // Slider panel
  const sliderPanel = document.getElementById('slider-panel');
  const sliderLabel = document.getElementById('slider-label');
  const slider = document.getElementById('slider');

  // Filters config: css filter function + default value + max/min for slider
  const filtersConfig = {
    hue: { css: v => `hue-rotate(${v}deg)`, default: 0, min: -180, max: 180, step: 1 },
    sepia: { css: v => `sepia(${v}%)`, default: 0, min: 0, max: 100, step: 1 },
    blur: { css: v => `blur(${v}px)`, default: 0, min: 0, max: 10, step: 0.1 },
    bmw: { css: v => `contrast(${100+v}%) saturate(${100+v}%)`, default: 0, min: -50, max: 50, step: 1 }, // custom filter example
    grayscale: { css: v => `grayscale(${v}%)`, default: 0, min: 0, max: 100, step: 1 },
    invert: { css: v => `invert(${v}%)`, default: 0, min: 0, max: 100, step: 1 },
    brightness: { css: v => `brightness(${v}%)`, default: 100, min: 50, max: 150, step: 1 },
    contrast: { css: v => `contrast(${v}%)`, default: 100, min: 50, max: 150, step: 1 },
    saturation: { css: v => `saturate(${v}%)`, default: 100, min: 50, max: 150, step: 1 },
    others: { css: v => `opacity(${v}%)`, default: 100, min: 0, max: 100, step: 1 }
  };

  // Update filter on canvas by redrawing original image with css filter applied on canvas container
  function applyFilter() {
    if (!originalImage) return;
    const filterFn = filtersConfig[currentFilter]?.css;
    if (!filterFn) {
      canvas.style.filter = 'none';
      return;
    }
    const val = currentFilterValue;
    canvas.style.filter = filterFn(val);
  }

  // Reset filter settings
  function resetFilter() {
    currentFilter = null;
    currentFilterValue = 100;
    sliderPanel.style.display = 'none';
    slider.value = 100;
    sliderLabel.textContent = '';
    canvas.style.filter = 'none';

    // Remove active class from filter items
    filterList.querySelectorAll('li').forEach(li => li.classList.remove('active'));
  }

  // Click filter category
  filterList.querySelectorAll('li').forEach(li => {
    li.addEventListener('click', () => {
      if (!originalImage) {
        alert('Silakan upload gambar terlebih dahulu');
        return;
      }
      // Set active class highlight
      filterList.querySelectorAll('li').forEach(i => i.classList.remove('active'));
      li.classList.add('active');

      currentFilter = li.dataset.filter;
      const conf = filtersConfig[currentFilter];
      if (!conf) {
        sliderPanel.style.display = 'none';
        return;
      }
      slider.min = conf.min;
      slider.max = conf.max;
      slider.step = conf.step;
      slider.value = conf.default;
      sliderLabel.textContent = li.textContent;
      currentFilterValue = conf.default;

      sliderPanel.style.display = 'block';
      applyFilter();
    });
  });

  // Slider input
  slider.addEventListener('input', () => {
    currentFilterValue = slider.value;
    applyFilter();
  });

  // Download function
  const downloadBtn = document.getElementById('download-btn');
  const downloadRes = document.getElementById('download-res');
  downloadBtn.addEventListener('click', () => {
    if (!originalImage) {
      alert('Silakan upload gambar terlebih dahulu');
      return;
    }
    const scale = downloadRes.value / canvas.width;
    const dw = downloadRes.value;
    const dh = canvas.height * scale;

    const offscreen = document.createElement('canvas');
    offscreen.width = dw;
    offscreen.height = dh;
    const offCtx = offscreen.getContext('2d');

    // Apply filter as CSS filter string
    offCtx.filter = canvas.style.filter || 'none';
    offCtx.drawImage(originalImage, 0, 0, dw, dh);

    offscreen.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dsrt_edit.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
  });

  // Back button (dummy)
  const backBtn = document.getElementById('back-btn');
  backBtn.addEventListener('click', () => {
    alert('Back button clicked - implement navigasi fitur lain di sini');
  });

  // Init: collapse lists by default
  filterList.classList.remove('expanded');
  toolsList.classList.remove('expanded');
  filterHeader.classList.remove('expanded');
  toolsHeader.classList.remove('expanded');

</script>

</body>
  </html>
